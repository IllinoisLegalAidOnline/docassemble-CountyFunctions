include:
  - docassemble.AssemblyLine:assembly_line.yml
  - docassemble.ALToolbox:phone-number-validation.yml
  - docassemble.ILAO:ilao-interview-framework.yml
  - docassemble.ILAO:shared-basic-questions.yml
---
code: |
  ilao_easy_form_title = "CountyFunctions"
  ilao_easy_form_url = "https://www.illinoislegalaid.org/"
  github_user = 'IllinoisLegalAidOnline'
  github_repo_name = 'docassemble-CountyFunctions'
---
objects:
  - test_person: ALIndividual
  - court_list: ALCourtLoader.using(file_name='docassemble.ILAO:data/sources/il_courts.xlsx')
  - test_address: ALAddress
---
# interview order block
mandatory: True
code: |
  test_person.address.address
  test_person.address.county_correct
  test_address.address
  test_address.county_correct
  get_docs_screen
---
id: test person address
question: |
  Let's try out an address!
fields:
  - Street address: test_person.address.address
    address autocomplete: True
  - Address line 2: test_person.address.unit
    required: False
  - City: test_person.address.city
  - State: test_person.address.state
    code: |
      states_list() 
  - ZIP code: test_person.address.zip
  - County: test_person.address.county
---
id: test address
question: |
  Let's try out another address!
fields:
  - Street address: test_address.address
    address autocomplete: True
  - Address line 2: test_address.unit
    required: False
  - City: test_address.city
  - State: test_address.state
    code: |
      states_list() 
  - ZIP code: test_address.zip
  - County: test_address.county
---
generic object: ALAddress
code: |  
  if is_illinois_county(x) == True:
    if county_in_list(x.county) == False:
      x.trial_court_index
      x.county = trial_court.address.county + " County" 
    else:
      x.county = end_in_county(x.county)
  else:
    x.county = end_in_county(x.county)
  x.county_correct = True
---
depends on:
  - x.county
generic object: ALAddress
id: county dropdown
question: |
  What county is ${x.on_one_line()} in?
subquestion: |
  We could not find the county for ${ x.on_one_line(bare=True) } in the list of Illinois counties, but you can select it here.

  ${ collapse_template(county_lookup_help) }
fields:
  - no label: x.trial_court_index
    code: |
      court_county_lookup()
validation code: |
  if x.trial_court_index == "-1":
    trial_court = court_list.as_court('trial_court', 15)
  else:
    trial_court = court_list.as_court('trial_court', x.trial_court_index)
  #x.county = trial_court.address.county + " County" 
---
code: |
  def court_county_lookup(lowercase=False):
    all_court_counties = court_list._load_courts()['address_county'].items()
    filtered_courts = [(-1, "cook")] if lowercase else [(-1, "Cook")]
    for court in all_court_counties:
      if court[1] != "Cook":
        court_name = court[1].lower() if lowercase else court[1]
        filtered_courts.append((court[0],court_name))
    return sorted( filtered_courts, key=lambda y: y[1])
---
template: county_lookup_help
subject: |
  **How do I look up the county?**
content: |  
  You can use this **[City-to-County Finder](https://www.statsamerica.org/CityCountyFinder/)** to find the county.
---
code: |
  def is_illinois_county(address_input):
    if address_input.state == "IL":
      return True
    else:    
      return False
---
code: |
  def county_in_list(input_county):
    county_name_storage = input_county.lower()
    if county_name_storage.endswith (" county"):
      county_name_storage = input_county.lower()[0:-7]
    county_found_storage = False
    for item in get_county_list():
      if county_name_storage == str(item).lower():
        county_found_storage = True
    if county_found_storage == True:
      return True
    else:
      return False
---
code: |
  def end_in_county(input_county):
    if input_county.lower().endswith(" county"):
      return input_county
    else:
      return input_county + " County" 
---
code: |
  def court_county_lookup(lowercase=False):
    all_court_counties = court_list._load_courts()['address_county'].items()
    filtered_courts = [(-1, "cook")] if lowercase else [(-1, "Cook")]
    for court in all_court_counties:
      if court[1] != "Cook":
        court_name = court[1].lower() if lowercase else court[1]
        filtered_courts.append((court[0],court_name))
    return sorted( filtered_courts, key=lambda y: y[1])
---
code: |
  def get_county_list(lowercase=False):
    county_list = [*set(court_list._load_courts()['address_county'])]
    county_list.sort()
    return county_list
---
#add function append county
---
id: get docs screen
event: get_docs_screen
question: |
  End Screen
subquestion: |

  ALIndividual object address: ${ test_person.address.on_one_line(bare=True) } 
  
  ALIndividual object county: ${ test_person.address.county }

  ALAddress object address: ${ test_address.on_one_line(bare=True) } 
  
  ALAddress object county: ${ test_address.county }

  Thank you for using ILAO Easy Forms!
  
  ${ action_button_html(url_action('review_answers'), label=':edit: Make changes', color='success', size="md") }
---
id: review screen
event: review_answers
question: |
  Review screen
subquestion: |
  Edit your answers below.
review: 
  - label: Edit
    fields:
      - test_person.address.address
      - recompute:
        - test_person.address.county_correct
    button: |
      **test_person county:**
      ${test_person.address.county}
  - label: Edit
    fields:
      - test_address.address
      - recompute:
        - test_address.county_correct
    button: |
      **test_address county:**
      ${test_address.county}      